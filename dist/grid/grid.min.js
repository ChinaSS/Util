define([],function(){function e(e){this.config=e,this.selected={},this.pageInfo={curPage:1,curPageData:[],allDataCount:0,pageCount:0}}var t={},a={};t.init=function(t){var n=new e($.extend({pageSize:10},t));return n.render(),a[t.id]=n,n},e.prototype.render=function(){var e=this.config,t=$("#"+e.placeAt).addClass("s_grid").empty();t.append('<div class="s_grid_title"></div>');var a=$('<div class="s_grid_content"></div>');a.append('<div class="s_grid_toolbar"></div>'),a.append('<div><table class="table table-hover"><thead></thead><tbody></tbody></table></div>'),a.append('<div class="s_grid_pagination"></div>'),e.hidden&&a.css({display:"none"}),t.append(a),this.renderTitle(),this.renderToolbar(),this.renderGridHead(),this.renderGridContent(),this.renderPagination()},e.prototype.getSelectedRow=function(){var e=[];for(var t in this.selected)e.push(this.selected[t]);return e},e.prototype.getData=function(){return this.data},e.prototype.getRow=function(){},e.prototype.addRow=function(){},e.prototype.removeRow=function(){},e.prototype.clear=function(){},e.prototype.renderTitle=function(){var e=this.config,t=$("#"+e.placeAt).find(".s_grid_title").empty();if("undefined"==typeof e.title&&1!=e.hidden)return void t.remove();if(t.append(e.title||"数据列表"),"undefined"!=typeof e.hidden){var a=$('<i class="glyphicon"></i>');a.addClass(e.hidden?"glyphicon-plus-sign":"glyphicon-minus-sign"),a.bind("click",function(e){var t=e.target,a=$(e.target).parents(".s_grid").find(".s_grid_content");"glyphicon glyphicon-plus-sign"==t.className?($(t).removeClass("glyphicon-plus-sign").addClass("glyphicon-minus-sign"),a.slideDown()):"glyphicon glyphicon-minus-sign"==t.className&&($(t).removeClass("glyphicon-minus-sign").addClass("glyphicon-plus-sign"),a.slideUp())}),t.append(a)}},e.prototype.renderToolbar=function(){var e=this,t=$("#"+e.config.placeAt).find(".s_grid_toolbar");if(!this.config.toolbar)return void t.remove();for(var a=$("<ul></ul>"),n=0;n<e.config.toolbar.length;n++){var i=e.config.toolbar[n];$("<li "+(0==n?'class="first"':"")+'><a><i class="'+i.class+'">&nbsp;</i>'+i.name+"</a></li>").bind("click",e,i.callback).appendTo(a)}t.append(a)},e.prototype.renderGridHead=function(){var e=this.config,t=this;if("string"==typeof e.index)var a="checkbox"==e.index?$(o(e)).css({width:"20px"}).bind("click",function(e){var a=e.target;"input"==a.nodeName.toLowerCase()&&$(a).parents("table").find("tr td:first-child :checkbox").each(function(e,i){i.checked=a.checked,e>0&&n(t,e,i.checked)})}):"<td width='20px'></td>";for(var i,r=$("<tr></tr>").append(a),s=0;i=e.layout[s++];){var d="undefined"!=typeof i.sort?'&nbsp;&nbsp;<i class="fa fa-sort"></i>':"",c=$("<td "+("undefined"!=typeof i.style?'style="'+i.style+'"':"")+">"+i.name+d+"</td>");d&&c.bind("click",function(a){var n,i;n="td"==a.target.nodeName.toLowerCase()?a.target.lastChild:a.target;var o="td"==a.target.nodeName.toLowerCase()?a.target:a.target.parentNode;$(o).parents("tr").children().each(function(e){$(this).is(o)&&(i=e-1)}),"fa fa-sort-asc"==n.className?($(n).removeClass().addClass("fa fa-sort-desc"),e.layout[i].sort="desc"):($(n).removeClass().addClass("fa fa-sort-asc"),e.layout[i].sort="asc"),t.pageInfo.curPage=1,t.selected={},t.renderGridContent(),t.renderPagination()}),r.append(c)}$("#"+this.config.placeAt).find("thead").append(r)},e.prototype.renderGridContent=function(){this.initRenderInfo();for(var e,t=this,a=t.config,i=t.pageInfo.curPageData,r=$("#"+this.config.placeAt).find("tbody").empty(),s=o(a),d=0;e=i[d++];){var c=$(s);t.selected[t.pageInfo.curPage+"_"+d]&&(c.find(":checkbox")[0].checked=!0);for(var p,l=$("<tr></tr>").append(c),f=0;p=a.layout[f++];){var g="undefined"==e[p.field]?"":e[p.field],u={value:g,config:a,data:i,rowIndex:d,cellIndex:f};"function"==typeof p.format&&(g=p.format.apply(this,[u])),"function"==typeof p.click&&(g=$("<a>"+g+"</a>").bind("click",u,p.click)),$("<td "+("undefined"!=typeof p.style?'style="'+p.style+'"':"")+"></td>").append(g).appendTo(l)}l.bind("click",function(e){var a=$(this).find("td:first input")[0];a.checked=$(a).is(e.target)?a.checked:!a.checked;for(var i,o,s="tr"==e.target.nodeName.toLowerCase()?$(e.target):$(e.target).parents("tr"),d=0;o=r.children()[d++];)s.is(o)&&(i=d);n(t,i,a.checked)}),r.append(l)}if(i.length<t.config.pageSize)for(var h=t.config.index?"<td></td>":"",y=0;y<t.config.pageSize-i.length;y++){for(var v,b=$("<tr "+(y>0?"class='emptyRow'":"height='39px'")+"></tr>").append(h),m=0;v=a.layout[m++];)b.append("<td>&nbsp;</td>");r.append(b)}};var n=function(e,t,a){a?e.selected[e.pageInfo.curPage+"_"+t]=e.pageInfo.curPageData[t-1]:delete e.selected[e.pageInfo.curPage+"_"+t]};e.prototype.initRenderInfo=function(){var e=this.config;if("[object Array]"===Object.prototype.toString.call(e.data)){for(var t=parseInt(e.data.length/e.pageSize),a=e.data.length%e.pageSize==0?t:t+1,n=this.pageInfo.curPage,o=1==n?1:(n-1)*e.pageSize+1,r=n*e.pageSize>=e.data.length?e.data.length:n*e.pageSize,s=[],d=o;r>=d;d++)s.push(e.data[d-1]);this.pageInfo={curPage:n,curPageData:s,allDataCount:e.data.length,pageCount:a}}else switch(e.data.type){case"URL":this.pageInfo=i(this);break;case"SQL":this.pageInfo=i(this);break;default:return[]}};var i=function(e){for(var t,a={},n={},i=0;t=e.config.layout[i++];)"undefined"!=typeof t.sort&&(n[t.field]="desc"==t.sort?"desc":"asc");return $.ajax({type:"POST",async:!1,url:"URL"==e.config.data.type?e.config.data.value:"/util/v1/gird",dataType:"json",data:{data:JSON.stringify({pageSize:e.config.pageSize,curPage:e.pageInfo.curPage,sort:n})},success:function(e){a=e},error:function(e,t,a){console.log(a)}}),a},o=function(e){var t="";switch(e.index){case"checkbox":t='<td><input type="checkbox"/></td>';break;case"radio":t='<td><input type="radio" name="s_gird_'+e.id+'_radio"/></td>'}return t};e.prototype.renderPagination=function(){var e=[],t=this,a=$("#"+this.config.placeAt).find(".s_grid_pagination");if(this.pageInfo.pageCount<=1)return void a.remove();e.push('<a title="第一页" class="GoToFirst"><i class="glyphicon glyphicon-step-backward"></i></a>'),e.push('<a title="上一页" class="GoToPrev"><i class="glyphicon glyphicon-chevron-left" style="font-size:13px"></i></a>'),e.push('<span style="float:left;padding-left:7px;padding-right:7px">第&nbsp;<input type="text" value="<%= curPage %>"/>&nbsp;页</span>'),e.push('<a title="下一页" class="GoToNext"><i class="glyphicon glyphicon-chevron-right" style="font-size:13px"></i></a>'),e.push('<a title="最后一页" class="GoToEnd"><i class="glyphicon glyphicon-step-forward"></i></a>'),e.push('<span style="float:right"><%= rowStart %>-<%= rowEnd %>&nbsp;&nbsp;&nbsp;&nbsp;共<%= count %>条</span>');var n=t.pageInfo.pageCount,i=this.pageInfo.curPage,o=this.pageInfo.allDataCount,s=r(e.join(""),{curPage:i,rowStart:1==i?1:(i-1)*this.config.pageSize+1,rowEnd:i*this.config.pageSize>=o?o:i*this.config.pageSize,count:o});a.unbind().empty().append(s),a.bind("click",function(e){var a=e.target,i=a.nodeName.toLowerCase(),o=parseInt($(this).find("input").val());if("i"==i&&"fa fa-step-backward"==a.className||"a"==i&&"GoToFirst"==a.className)o=1;else if("i"==i&&"fa fa-caret-left"==a.className||"a"==i&&"GoToPrev"==a.className)o=o>1?o-1:1;else if("i"==i&&"fa fa-caret-right"==a.className||"a"==i&&"GoToNext"==a.className)o=o==n?o:o+1;else{if(!("i"==i&&"fa fa-step-forward"==a.className||"a"==i&&"GoToEnd"==a.className))return;o=n}t.pageInfo.curPage=o>=n?n:o,t.renderGridContent(),t.renderPagination()}),a.find("input").blur(function(){var e=parseInt(this.value);e>=n?e=n:1>=e&&(e=1),t.pageInfo.curPage=e,t.initRenderInfo(),t.renderGridContent(),t.renderPagination()})};var r=function(){var e={};return function(t,a){var n=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):e[t]=e[t]||util.template(document.getElementById(t).innerHTML);return a?n(a):n}}();return t.getGrid=function(e){return a[e]},t});
define(["jquery"],function(a){function t(t){if("13"==t.which)t.target==l[0]?r():t.target==d.children("a:focus")[0]&&o(a(t.target).text());else if(("40"==t.which||"38"==t.which)&&(t.preventDefault(),t.stopPropagation(),d.is(":visible"))){var e=d.children("a"),n=e.length;if(!n)return!1;if("40"==t.which)s=(++s+n)%n;else{if(0===s)return s=-1,d.children("a:focus").blur(),l.focus(),o(p),!1;-1===s?s+=n:s=(--s+n)%n}d.children("a:focus").blur();var i=a(e[s]).focus().text();o(i)}}function e(){var t=a.trim(l.val());return p=t,u(),""==t?(d.empty().hide(),!1):void(c=setTimeout(function(){c=null,s=-1,i()},400))}function n(a){var t=0;a=a?a:[],d.empty();for(var e=a.length;--e>-1&&10>t;){var n=a[e];n.indexOf(p)>-1&&(n=n.replace(p,"<span>"+p+"</span>"),d.append("<a href='#'>"+n+"</a>"),t++)}0==t&&d.append("<p>no suggest</p>"),d.show()}function i(){"string"==typeof f.param.data?a.ajax({type:"GET",url:f.param.data,data:p,dataType:"json",success:function(a){n(a)},error:function(){console.log("ajax error")}}):n(f.param.data)}function r(t,e){"undefined"==typeof e&&(e=a.trim(l.val())),e&&(u(),d.hide(),f.param.callback(e))}function o(t){t=a.trim(t),l.val(t)}function u(){c&&clearTimeout(c)}var c,p,l,d,s=-1,f={param:{id:null,btn:null,lazyMatch:!0,data:null,callback:function(a){console.log(a)}},fn:{}};return f.fn.init=function(n){a.extend(f.param,n),$elem=a("#"+f.param.id);var i='<div class="typeahead">';i+=f.param.btn?'<div class="input-group"><input type="text" class="form-control typeahead-input"><span class="input-group-btn"><button class="btn btn-primary typeahead-submit" type="button">'+f.param.btn+"</button></span></div>":'<input type="text" class="form-control typeahead-input">',i+='<div class="typeahead-suggest"></div></div>',$typeahead=$elem.after(i).siblings(".typeahead"),$elem.remove(),l=$typeahead.find(".typeahead-input").attr("id",f.param.id),d=$typeahead.find(".typeahead-suggest"),f.param.btn&&$typeahead.find(".typeahead-submit").on("click",r),l.on("keyup",e).on("focus",function(){p&&!c&&e()}),d.on("mouseover",function(){d.children("a:focus").blur(),s=-1}).delegate("a","click",function(){o(a(this).text()),r()}),a(document).on("keydown",t).on("click",function(a){a.target!=l[0]&&d.hide()})},f.fn});